/**
 * Plugin for top menu
 *
 * @version 2.1.0
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @description add top menu on sheet
 * ReleaseNote:
 * 2.1 : Migrate on JSS v10
 * 2.0 : Migrate on JSS v8
 * 1.1 : New organisation item
 * 1.0 : Init plugin
 * @license This plugin is distribute under MIT License
 */
if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");if(!jspreadsheet&&"function"==typeof require)var jspreadsheet=require("jspreadsheet");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jss_topmenu=t()}(this,function(){return function(e,t,n){let s="Ctrl +";/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/.test(window.navigator.userAgent)&&(s="âŒ˜ +");let l={};l.options=Object.assign({},t),l.topmenu=null,l.menus=[];let i=null,o=null,r=null,u=!1,c={text_file:jSuites.translate("File"),text_edit:jSuites.translate("Edit"),text_view:jSuites.translate("View"),text_item_rename:jSuites.translate("Rename"),text_item_insert:jSuites.translate("Insert"),text_item_delete:jSuites.translate("Delete"),text_item_newworksheet:jSuites.translate("New worksheet"),text_item_fullscreenexit:jSuites.translate("Exit fullscreen"),text_item_fullscreenenter:jSuites.translate("Enter fullscreen"),text_item_resetfilters:jSuites.translate("Reset filter(s)"),menus:{File:function(t,n,i){let o=[],r=t.tabs.headers.querySelector(".jtabs-selected"),u=e.getWorksheetActive(),c=Array.isArray(t.jspreadsheet)?t.jspreadsheet.length:1;return!1!=e.config.tabs&&!0==e.config.tabs.allowCreate&&(o.push({icon:"tab",disabled:!n.options.editable,title:l.options.text_item_newworksheet,onclick:function(){n.createWorksheet()}}),r&&!0==e.config.allowRenameWorksheet&&o.push({icon:"edit",disabled:!n.options.editable,title:jSuites.translate("Rename this worksheet")+` (${r.innerText})`,onclick:function(){if(null!=r){let t=prompt(jSuites.translate("Rename this worksheet"),r.innerText);t&&e.renameWorksheet(u,t)}}}),r&&!0==e.config.allowDeleteWorksheet&&c>1&&o.push({icon:"tab_unselected",disabled:!n.options.editable,title:jSuites.translate("Delete this worksheet")+` (${r.innerText})`,onclick:function(){null!=r&&confirm(jSuites.translate("Are you sure to delete this worksheet?"),r.innerText)&&e.deleteWorksheet(u)}}),o.push({type:"line"})),!0==e.config.allowExport&&(o.push({icon:"save",title:jSuites.translate("Save as")+" CSV",shortcut:s+" S",onclick:function(){n.download()}}),o.push({type:"line"})),e.config.about&&o.push({icon:"info",title:jSuites.translate("About"),onclick:function(){!0===e.config.about?alert(jspreadsheet.version(!0)):alert(e.config.about)}}),o},Edit:function(e,t,n){let i=[];if(i.push({icon:"undo",title:jSuites.translate("Undo"),disabled:!t.options.editable,shortcut:s+" Z",onclick:function(){jspreadsheet.current?jspreadsheet.current.undo():t.undo()}}),i.push({icon:"redo",title:jSuites.translate("Redo"),disabled:!t.options.editable,shortcut:s+" Y",onclick:function(){jspreadsheet.current?jspreadsheet.current.redo():t.redo()}}),i.push({type:"line"}),i.push({icon:"content_cut",title:jSuites.translate("Cut"),shortcut:s+" X",onclick:function(){jspreadsheet.current?jspreadsheet.current.copy(!0):t.copy(!0)}}),i.push({icon:"content_copy",title:jSuites.translate("Copy"),shortcut:s+" C",onclick:function(){jspreadsheet.current?jspreadsheet.current.copy():t.copy()}}),navigator&&navigator.clipboard&&navigator.clipboard.readText&&i.push({icon:"content_paste",title:jSuites.translate("Paste"),disabled:!t.options.editable,shortcut:s+" V",onclick:function(){t.selectedCell&&navigator.clipboard.readText().then(function(e){e&&jspreadsheet.current.paste(t.selectedCell[0],t.selectedCell[1],e)})}}),null!=t.selectedCell){i.push({type:"line"});let o=[],r=[],u=[],c=jspreadsheet.helpers.getColumnNameFromCoords(t.selectedCell[0],t.selectedCell[1]),a=jspreadsheet.helpers.getColumnNameFromCoords(t.selectedCell[2],t.selectedCell[3]),p=c.substring(0,c.length-(""+(+t.selectedCell[1]+1)).length),d=a.substring(0,a.length-(""+(+t.selectedCell[3]+1)).length),h;h=p!=d?`${p} - ${d}`:p,!0==t.options.allowInsertColumn&&(o.push({title:jSuites.translate("Insert a new column before")+` (${p})`,onclick:function(){t.insertColumn(1,parseInt(t.selectedCell[0]),1)}}),o.push({title:jSuites.translate("Insert a new column after")+` (${p})`,onclick:function(){t.insertColumn(1,parseInt(t.selectedCell[0]),0)}})),!0==t.options.allowDeleteColumn&&r.push({title:jSuites.translate("Delete selected columns")+` (${h})`,disabled:!t.options.editable,onclick:function(){t.deleteColumn(t.getSelectedColumns().length?void 0:parseInt(t.selectedCell[0]))}}),!0==t.options.allowRenameColumn&&u.push({title:jSuites.translate("Rename this column")+` (${p})`,onclick:function(){t.setHeader(parseInt(t.selectedCell[0]))}});let f=+t.selectedCell[1]+1,m=+t.selectedCell[3]+1,j;j=f!=m?`${f} - ${m}`:f,!0==t.options.allowInsertRow&&(o.push({title:jSuites.translate("Insert a new row before")+` (${f})`,onclick:function(){t.insertRow(1,parseInt(t.selectedCell[1]),1)}}),o.push({title:jSuites.translate("Insert a new row after")+` (${f})`,onclick:function(){t.insertRow(1,parseInt(t.selectedCell[1]))}})),!0==t.options.allowDeleteRow&&r.push({title:jSuites.translate("Delete selected rows")+` (${j})`,disabled:!t.options.editable,onclick:function(){t.deleteRow(t.getSelectedRows().length?void 0:parseInt(t.selectedCell[1]))}}),o.length>0&&i.push({title:l.options.text_item_insert,icon:"add",submenu:o}),r.length>0&&i.push({title:l.options.text_item_delete,icon:"remove",submenu:r}),u.length>0&&i.push({title:l.options.text_item_rename,icon:"edit",submenu:u})}return i},View:function(e,t,n){let s=[];if(e.classList.contains("fullscreen")?s.push({icon:"fullscreen_exit",title:l.options.text_item_fullscreenexit,onclick:function(){j().fullscreen(!1)}}):s.push({icon:"fullscreen",title:l.options.text_item_fullscreenenter,onclick:function(){j().fullscreen(!0)}}),null!=t.selectedCell){let i=jspreadsheet.helpers.getColumnNameFromCoords(t.selectedCell[0],t.selectedCell[1]),o=i.substring(0,i.length-(""+(+t.selectedCell[1]+1)).length);!0==t.options.columnSorting&&(s.push({type:"line"}),s.push({title:jSuites.translate("Order ascending")+` (${o})`,onclick:function(){t.orderBy(parseInt(t.selectedCell[0]),0)}}),s.push({title:jSuites.translate("Order descending")+` (${o})`,onclick:function(){t.orderBy(parseInt(t.selectedCell[0]),1)}}))}return!0==t.options.filters&&(s.push({type:"line"}),s.push({title:l.options.text_item_resetfilters,onclick:function(){t.resetFilters()}})),s}}};for(let a in null==l.options&&(l.options={}),c)l.options.hasOwnProperty(a)&&null!=l.options[a]||(l.options[a]=c[a]);function p(e,t){return t==e||t!=document&&p(e,t.parentNode)}function d(){for(let t=0;t<l.menus.length;t++){let n=l.menus[t],i=document.createElement("BUTTON");switch(n.name){case"File":i.innerHTML=l.options.text_file;break;case"Edit":i.innerHTML=l.options.text_edit;break;case"View":i.innerHTML=l.options.text_view;break;default:i.innerHTML=n.name}i.addEventListener("click",function(t,n){return function(l){if(u&&this==r){m();return}u=!0,h(this);let i=l.target.getBoundingClientRect(),c,a={x:i.left,y:i.top+i.height},p;for(let d in p="function"==typeof t?t(e.el,j(),this):t.slice(),e.plugins){let f=e.plugins[d];f.topMenu&&"function"==typeof f.topMenu&&(p=f.topMenu(n,p,this,s))}o.open(a,p),l.preventDefault(),l.stopPropagation()}}(n.items,n.name)),i.addEventListener("mouseover",function(e){u&&e.target!=r&&this.dispatchEvent(new Event("click"))}),l.topmenu.append(i)}}function h(e){null!=r&&f(r),e.classList.add("active"),r=e}function f(e){r==e&&(r=null),null!=e&&(e.classList.remove("active"),o.close())}function m(){o.close(),f(r),u=!1}function j(){return jspreadsheet.current?jspreadsheet.current:null!=e.getWorksheetActive()?e.worksheets[e.getWorksheetActive()]:e.worksheets[0]}return l.onevent=function(t,n){"onload"==t&&(e.tools.insertBefore(l.topmenu,e.tools.firstChild),(i=document.createElement("DIV")).className="jss_contextmenu",o=jSuites.contextmenu(i,{onclick:function(){m()}}),e.el.append(i))},l.contextMenu=function(e,t,n,s,i){return p(l.topmenu,s.target)?[]:i},l.add=function(e,t,n){null!=l.topmenu?(null==t&&(t=[]),null!=n?l.menus.splice(n,0,{name:e,items:t}):l.menus.push({name:e,items:t}),l.refresh()):console.error("Topmenu bar is not loaded")},e.addTopmenu=l.add,l.refresh=function(){l.topmenu.innerHTML="",d()},function e(){for(let t in l.options.menus)l.menus.push({name:t,items:l.options.menus[t]})}(),l.topmenu=document.createElement("DIV"),l.topmenu.classList.add("jss-topmenu"),l.topmenu.classList.add("jexcel_object"),d(),document.addEventListener("keydown",function(e){27==e.which&&!0==u&&(m(),e.preventDefault(),e.stopPropagation())}),document.addEventListener("click",function(e){u&&(!p(l.topmenu,e.target)||e.target==l.topmenu)&&(m(),e.preventDefault(),e.stopPropagation())}),l}});