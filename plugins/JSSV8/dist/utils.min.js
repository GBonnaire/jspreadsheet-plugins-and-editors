/**
 * Plugin to add utils feature on jspreadsheet Pro
 *
 * @version 1.3.0
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @description Plugin to add utils feature on jspreadsheet Pro like :
 *  - Move rows
 *  - Duplicate Row
 *  - Hide Sheet
 *  - Hide columns / show columns
 *  - Hide rows / show rows
 *  - Zoom
 *
 *  @event onzoom(worksheet: Object, zoomValue: int) dispatch on onevent in options of JSS
 *
 * @license This plugin is distribute under MIT License
 *
 * ReleaseNote :
 * 1.0 : Create plugin
 * 1.1 : Add zoom feature
 * 1.2 : Add hide / show row feature
 * 1.3 : Add show hidden rows and columns in 1 time
 */
var jSuites,jspreadsheet;jSuites||"function"!=typeof require||(jSuites=require("jsuites")),jspreadsheet||"function"!=typeof require||(jspreadsheet=require("jspreadsheet")),function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):o.jss_utils=t()}(this,function(){return function(E,o,t){const H={};let e={};H.options=Object.assign({},o);var n={allow:{moveRow:!0,duplicateRow:!0,hideSheet:!0,hideColumn:!0,hideRow:!0,zoom:!0},icon:{moveUpRow:"arrow_upward",moveDownRow:"arrow_downward",duplicateRow:"content_copy",hideRow:"visibility_off",showRow:"visibility",showRows:"visibility",hideColumn:"visibility_off",showColumn:"visibility",showColumns:"visibility",hideWorksheet:"visibility_off"},text:{moveUpRow:jSuites.translate("Move up row(s) selected"),moveDownRow:jSuites.translate("Move down row(s) selected"),duplicateRow:jSuites.translate("Duplicate row(s) selected"),hideRow:jSuites.translate("Hide row(s) selected"),showRow:jSuites.translate("Show hidden row ({0})"),showRows:jSuites.translate("Show hidden rows"),hideColumn:jSuites.translate("Hide column(s) selected"),showColumn:jSuites.translate("Show hidden column ({0})"),showColumns:jSuites.translate("Show hidden columns"),hideWorksheet:jSuites.translate("Hide this worksheet")}};null==H.options&&(H.options={});for(const r in n)if(H.options.hasOwnProperty(r)&&null!=H.options[r]){if("object"==typeof n[r]&&!Array.isArray(n[r]))for(const a in H.options[r])H.options[r].hasOwnProperty(a)&&null!=H.options[r][a]||(H.options[r][a]=n[r][a])}else H.options[r]=n[r];H.onevent=function(o,t){"onload"==o&&i.onload(E.element,E.element.tabs),"onresize"==o&&s.updateViewport(t,arguments[2]),"onopenworksheet"!=o&&"oncreateworksheet"!=o||s.update(t)},H.toolbar=function(o){var t={type:"i",content:"zoom_in",onclick:function(){s.in(10)}},e={type:"i",content:"zoom_out",onclick:function(){s.out(10)}},n={type:"label",content:"100%",id:"zoom_label",onclick:function(){var o=prompt(jSuites.translate("Set new zoom value"),s.get());s.set(o)},updateState(o,t,e,n){e.innerText=s.get(n)+"%"}};return o.items.push({type:"divisor"}),o.items.push(e),o.items.push(n),o.items.push(t),o},H.contextMenu=function(s,o,t,e,n,i){var l,c,r,a,p=D();if(null==o&&null!=t&&s.getSelectedRows(!0).length){let o=0;for(const h in n)if("divisor"==n[h].type||"line"==n[h].type){o=parseInt(h)+1;break}if(p.options.rowDrag&&H.options.allow.moveRow){const w={title:H.options.text.moveUpRow,onclick:function(){const o=s.getSelectedRows(!0);o.forEach(function(o){s.moveRow(o,o-1)});var t=Math.min(o),e=s.options.data[0].length-1,n=Math.max(o);s.updateSelectionFromCoords(0,t,e,n)}};H.options.icon.moveUpRow&&(w.icon=H.options.icon.moveUpRow),n.splice(o,0,w),o++;const m={title:H.options.text.moveDownRow,onclick:function(){const o=s.getSelectedRows(!0);o.reverse().forEach(function(o){s.moveRow(o,o+1)});var t=Math.min(o),e=s.options.data[0].length-1,n=Math.max(o);s.updateSelectionFromCoords(0,t,e,n)}};H.options.icon.moveDownRow&&(m.icon=H.options.icon.moveDownRow),n.splice(o,0,m),o++}if(p.options.editable&&H.options.allow.duplicateRow){const f={title:H.options.text.duplicateRow,onclick:function(){var o=s.getSelectedRows(!0);let t=Math.max(o);const e=s.getData(!0);e.forEach(function(o){s.insertRow(o,t),t++});var n=Math.min(o),i=s.options.data[0].length-1,o=t;s.updateSelectionFromCoords(0,n,i,o)}};H.options.icon.duplicateRow&&(f.icon=H.options.icon.duplicateRow),n.splice(o,0,f),o++}if(H.options.allow.hideRow){const g={title:H.options.text.hideRow,onclick:function(){const o=s.getSelectedRows(!0);o.forEach(function(o){s.hideRow(o)})}};H.options.icon.hideRow&&(g.icon=H.options.icon.hideRow),n.splice(o,0,g),o++;const v=Math.min(...s.getSelectedRows(!0)),R=Math.max(...s.getSelectedRows(!0));var u=s.getRow(v-1),d=s.getRow(R+1);if(u&&!1===u.visible){const b={title:H.options.text.showRow.replace("{0}",u.title||v+1-1),onclick:function(){s.showRow(v-1)}};H.options.icon.showRow&&(b.icon=H.options.icon.showRow),n.splice(o,0,b),o++}if(d&&!1===d.visible){const y={title:H.options.text.showRow.replace("{0}",d.title||R+1+1),onclick:function(){s.showRow(R+1)}};H.options.icon.showRow&&(y.icon=H.options.icon.showRow),n.splice(o,0,y),o++}if(v!=R){let t=!1;for(let o=v+1;o<R;o++)if(0==s.getRow(o).visible){t=!0;break}if(t){const C={title:H.options.text.showRows,onclick:(r=v,a=R,function(){for(let o=r+1;o<a;o++)0==s.getRow(o).visible&&s.showRow(o)})};H.options.icon.showRows&&(C.icon=H.options.icon.showRows),n.splice(o,0,C),o++}}}n.splice(o,0,{type:"line"})}else if(null==t&&null!=o&&s.getSelectedColumns().length){let o=0;for(const S in n)if(n[S].title===jSuites.translate("Insert a new column before")){o=parseInt(S);break}if(H.options.allow.hideColumn){const x={title:H.options.text.hideColumn,onclick:function(){const o=s.getSelectedColumns();o.forEach(function(o){s.hideColumn(o)})}};H.options.icon.hideColumn&&(x.icon=H.options.icon.hideColumn),n.splice(o,0,x),o++;const k=Math.min(...s.getSelectedColumns()),j=Math.max(...s.getSelectedColumns());u=s.getColumn(k-1),d=s.getColumn(j+1);if(u&&!1===u.visible){const I={title:H.options.text.showColumn.replace("{0}",u.title||jspreadsheet.helpers.getColumnName(k-1)),onclick:function(){s.showColumn(k-1)}};H.options.icon.showColumn&&(I.icon=H.options.icon.showColumn),n.splice(o,0,I),o++}if(d&&!1===d.visible){const O={title:H.options.text.showColumn.replace("{0}",d.title||jspreadsheet.helpers.getColumnName(j+1)),onclick:function(){s.showColumn(j+1)}};H.options.icon.showColumn&&(O.icon=H.options.icon.showColumn),n.splice(o,0,O),o++}if(k!=j){let t=!1;for(let o=k+1;o<j;o++)if(0==s.getColumn(o).visible){t=!0;break}if(t){const z={title:H.options.text.showColumns,onclick:(l=k,c=j,function(){for(let o=l+1;o<c;o++)0==s.getColumn(o).visible&&s.showColumn(o)})};H.options.icon.showColumns&&(z.icon=H.options.icon.showColumns),n.splice(o,0,z),o++}}}}else if(null==o&&null==t&&"tabs"==i){i=Array.isArray(E.el.jspreadsheet)?E.el.jspreadsheet.length:1;if(1<i&&H.options.allow.hideSheet){const M={title:H.options.text.hideWorksheet,onclick:function(){let o=E.el.tabs.headers.querySelector(".jtabs-selected");if(o){o.style.display="none";var n=Array.prototype.indexOf.call(E.el.tabs.headers.children,o);let t=1,e=n;for(let o=0;o<=E.el.tabs.headers.children.length-2&&(e+=t,!(e<0));o++){const i=E.el.tabs.headers.children[e];if(i.classList.contains("jtabs-border"))t=-1,e=n;else if("none"!==i.style.display){E.el.tabs.open(e);break}}}}};H.options.icon.hideWorksheet&&(M.icon=H.options.icon.hideWorksheet),n.unshift(M)}}return n},H.topMenu=function(o,t,e,n){if("Edit"===o){o=D();const s=o;if(null!=o.selectedCell){if(t.push({type:"line"}),o.options.rowDrag){const l={title:H.options.text.moveUpRow,onclick:function(){const o=s.getSelectedRows(!0);o.forEach(function(o){s.moveRow(o,o-1)});var t=Math.min(o),e=s.options.data[0].length-1,n=Math.max(o);s.updateSelectionFromCoords(0,t,e,n)}};H.options.icon.moveUpRow&&(l.icon=H.options.icon.moveUpRow),t.push(l);const c={title:H.options.text.moveDownRow,onclick:function(){const o=s.getSelectedRows(!0);o.reverse().forEach(function(o){s.moveRow(o,o+1)});var t=Math.min(o),e=s.options.data[0].length-1,n=Math.max(o);s.updateSelectionFromCoords(0,t,e,n)}};H.options.icon.moveDownRow&&(c.icon=H.options.icon.moveDownRow),t.push(c)}const i={title:H.options.text.duplicateRow,onclick:function(){var o=s.getSelectedRows(!0);let t=Math.max(o);const e=s.getData(!0);e.forEach(function(o){s.insertRow(o,t),t++});var n=Math.min(o),i=s.options.data[0].length-1,o=t;s.updateSelectionFromCoords(0,n,i,o)}};H.options.icon.duplicateRow&&(i.icon=H.options.icon.duplicateRow),t.push(i)}}return t};const i=function(){const o={onload:function(o,s){const t=s.headers.parentNode,e=document.createElement("DIV");e.className="jss_contextmenu",o.appendChild(e);const l=jSuites.contextmenu(e,{onclick:function(){l.close()}}),n=document.createElement("DIV");n.classList.add("jtabs-menu"),n.style.cursor="pointer";const i=document.createElement("SPAN");i.classList.add("material-icons"),i.innerHTML="list",n.append(i),n.addEventListener("click",function(o){o=o.target.getBoundingClientRect(),o={x:o.left,y:o.top+o.height};const n=[];for(let e=0;e<s.headers.children.length;e++)if(!s.headers.children[e].classList.contains("jtabs-border")){var i=s.headers.children[e].querySelector(".material-icons");let o=null,t="";t=i?(o=i.innerText,s.headers.children[e].innerText.substring(o.length)):s.headers.children[e].innerText,"none"===s.headers.children[e].style.display&&(t+=" "+jSuites.translate("(hidden)")),n.push({title:t,icon:o,disabled:s.headers.children[e].classList.contains("jtabs-selected"),onclick:function(o){return function(){"none"===s.headers.children[o].style.display&&(s.headers.children[o].style.display=""),s.open(o)}}(e)})}s.options.allowCreate&&n.push({title:jSuites.translate("New tab"),icon:"add_box",onclick:function(){s.create()}}),l.open(o,n)}),t.insertBefore(n,t.firstChild)}};return o}(),s=function(){const i={init:function(o){null==(o=null==o?D():o).options.pluginOptions&&(o.options.pluginOptions={}),null==o.options.pluginOptions.zoom&&(o.options.pluginOptions.zoom={value:100},i.updateViewport(),o.options.tableOverflow||window.addEventListener("scroll",function(){var o=D(),t=s.get(o)/100,e=document.body.scrollTop-document.body.scrollTop/t;for(const n of o.headerContainer.children)n.style.top=`${-e}px`}))},updateViewport:function(o,t,e){null==e&&(e=D()),i.init(e),null==o&&(o=parseInt(e.content.style.width||e.content.offsetWidth)),null==t&&(t=parseInt(e.content.style.height||e.content.style.offsetHeight)),e.options.pluginOptions.zoom.tableWidthInit=parseInt(o*i.get(e)/100),isNaN(e.options.pluginOptions.zoom.tableWidthInit)&&(e.options.pluginOptions.zoom.tableWidthInit=null),e.options.pluginOptions.zoom.tableHeightInit=parseInt(t*i.get(e)/100),isNaN(e.options.pluginOptions.zoom.tableHeightInit)&&(e.options.pluginOptions.zoom.tableHeightInit=null)},update:function(o){null==o&&(o=D()),i.init(o);var t=o.options.pluginOptions.zoom.tableHeightInit/(i.get(o)/100);o.content.style.marginBottom=`${o.options.pluginOptions.zoom.tableHeightInit-parseInt(t)}px`},set:function(o,t){var e,n;isNaN(parseInt(o))||(null==t&&(t=D()),e=Math.max(10,Math.min(200,parseInt(o))),t&&(t.content.style.transform="scale("+e/100+")",t.content.style.transformOrigin="top left",i.init(t),t.options.pluginOptions.zoom.value=e,n=t.options.pluginOptions.zoom.tableWidthInit/(e/100),o=t.options.pluginOptions.zoom.tableHeightInit/(e/100),t.content.style.marginBottom=`${t.options.pluginOptions.zoom.tableHeightInit-parseInt(o)}px`,t.options.tableOverflow?(l(),t.setViewport(parseInt(n),parseInt(o)),c()):E.toolbar.querySelector("#zoom_label").innerText=e+"%",i.update(t),t.dispatch("onzoom",t,e)))},get:function(o){return null==o&&(o=D()),i.init(o),o.options.pluginOptions.zoom.value},in:function(o,t){this.set(i.get()+o,t)},out:function(o,t){this.set(i.get()-o,t)}};return i}();function D(){return jspreadsheet.current||(null!=E.getWorksheetActive()?E.worksheets[E.getWorksheetActive()]:E.worksheets[0])}const l=function(){null==e.ignoreEvents&&(e.ignoreEvents=E.ignoreEvents),E.ignoreEvents=!0,null==e.ignoreCloud&&(e.ignoreCloud=E.ignoreCloud),null==e.ignoreHistory&&(e.ignoreHistory=E.ignoreHistory),E.ignoreHistory=!0,null==e.ignorePersistence&&(e.ignorePersistence=E.ignorePersistence),E.ignorePersistence=!0},c=function(){E.ignoreEvents=e.ignoreEvents,E.ignoreHistory=e.ignoreHistory,E.ignorePersistence=e.ignorePersistence,E.ignoreCloud=e.ignoreCloud,e={}};return H}});