/**
 * Plugin for change notification of persistence for jSpreadsheet Pro
 *
 * @version 2.0.1
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 *
 * @license This plugin is distribute under MIT License
 *
 * @description change notification of persistence
 * ReleaseNote
 * 2.0.1 compatibility ES6
 * 2.0.0 migrating to JSS v8 and change name persistance to persistence
 * 1.4.2 fix bug compatibility
 * 1.4.1 add require
 * 1.4.0 add time and showOnlyTime
 * 1.3.0 add compatibility NPM
 */
var jSuites;jSuites||"function"!=typeof require||(jSuites=require("jsuites")),function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.jss_persistenceFlag=o()}(this,function(){return function(s,e,o){const r={};let n=null,c=null,a=null,i=null,l=0,t=0;r.options=Object.assign({},e);var u,d={showText:!0,showOnlyTime:!1,iconError:"error",textError:jSuites.translate("not saved"),iconSuccess:"check_circle",textSuccess:jSuites.translate("saved at {date}"),iconProgress:"cached",cssProgress:"",textProgress:jSuites.translate("saving"),dateFormat:{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};for(u in null==r.options&&(r.options={}),d)r.options.hasOwnProperty(u)&&null!=r.options[u]||(r.options[u]=d[u]);function p(){l<=0?(t=0,i&&(jSuites.notification.isVisible=i)):(t++,5<t&&(console.error("TimeOut Reset",l),l=0,r.setSuccess()),setTimeout(p,1e3))}return r.onevent=function(e,o){var t;"onload"==e&&function(){n=document.createElement("div"),n.classList.add("jtoolbar-item"),n.classList.add("jss-flagPersistence"),r.options.showText&&(c=document.createElement("span"),n.appendChild(c));a=document.createElement("i"),a.classList.add("material-icons"),a.style.cssText="display:inline-block",n.appendChild(a),s.toolbar.children[0].appendChild(n)}(),"onbeforesave"==e&&s.config.toolbar?(l<0&&(l=0),i=i||jSuites.notification.isVisible,0==l&&(jSuites.notification.isVisible=function(){return!0}),l++,r.setInProgress()):"onblur"==e&&s.config.toolbar?0==l?p():setTimeout(p,1e3):"onsave"==e&&s.config.toolbar&&((t=arguments[4]).success?(l--,l<=0&&r.setSuccess()):(l=0,r.setError(),console.error(t)))},r.change=function(e,o,t,s){const n=new Date;let i;-1!=o.indexOf("{date}")&&(i=r.options.showOnlyTime?n.toLocaleTimeString(void 0):n.toLocaleDateString(void 0,r.options.dateFormat),o=o.replace("{date}",i)),-1!=o.indexOf("{time}")&&(i=n.toLocaleTimeString(void 0),o=o.replace("{time}",i)),a&&(a.innerHTML=e,a.style.color=s||"inherit",r.options.cssProgress&&(!0===t?a.classList.add(r.options.cssProgress):a.classList.remove(r.options.cssProgress))),c&&(c.innerHTML=o)},r.setInProgress=function(){r.change(r.options.iconProgress,r.options.textProgress,!0)},r.setSuccess=function(){r.change(r.options.iconSuccess,r.options.textSuccess,!1,"green")},r.setError=function(){r.change(r.options.iconError,r.options.textError,!1,"red")},r}});