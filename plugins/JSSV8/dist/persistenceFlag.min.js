/**
 * Plugin for change notification of persistence for jSpreadsheet Pro
 *
 * @version 2.0.4
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 *
 * @license This plugin is distribute under MIT License
 *
 * @description change notification of persistence
 * ReleaseNote
 * 2.0.4 migration v10
 * 2.0.1 compatibility ES6
 * 2.0.0 migrating to JSS v8 and change name persistance to persistence
 * 1.4.2 fix bug compatibility
 * 1.4.1 add require
 * 1.4.0 add time and showOnlyTime
 * 1.3.0 add compatibility NPM
 */
if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):e.jss_persistenceFlag=s()}(this,function(){return function(e,s,t){let o={},n=null,i=null,r=null,c=null,a=0,l=0;o.options=Object.assign({},s);let u={showText:!0,showOnlyTime:!1,iconError:"error",textError:jSuites.translate("not saved"),iconSuccess:"check_circle",textSuccess:jSuites.translate("saved at {date}"),iconProgress:"cached",cssProgress:"",textProgress:jSuites.translate("saving"),dateFormat:{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}};for(var d in null==o.options&&(o.options={}),u)o.options.hasOwnProperty(d)&&null!=o.options[d]||(o.options[d]=u[d]);function p(){a<=0?(l=0,c&&(jSuites.notification.isVisible=c)):(++l>5&&(console.error("TimeOut Reset",a),a=0,o.setSuccess()),setTimeout(p,1e3))}return o.onevent=function(s,t){if("onload"==s&&((n=document.createElement("div")).classList.add("jtoolbar-item"),n.classList.add("jss-flagPersistence"),o.options.showText&&(i=document.createElement("span"),n.appendChild(i)),(r=document.createElement("i")).classList.add("material-icons"),r.style.cssText="display:inline-block",n.appendChild(r),e.toolbar.children[0].appendChild(n)),"onbeforesave"==s&&e.config.toolbar)a<0&&(a=0),c||(c=jSuites.notification.isVisible),0==a&&(jSuites.notification.isVisible=function(){return!0}),a++,o.setInProgress();else if("onblur"==s&&e.config.toolbar)0==a?p():setTimeout(p,1e3);else if("onsave"==s&&e.config.toolbar){let l=arguments[4];l.success?--a<=0&&o.setSuccess():(a=0,o.setError(),console.error(l))}},o.change=function(e,s,t,n){let c=new Date,a;-1!=s.indexOf("{date}")&&(a=o.options.showOnlyTime?c.toLocaleTimeString(void 0):c.toLocaleDateString(void 0,o.options.dateFormat),s=s.replace("{date}",a)),-1!=s.indexOf("{time}")&&(a=c.toLocaleTimeString(void 0),s=s.replace("{time}",a)),r&&(r.innerHTML=e,n?r.style.color=n:r.style.color="inherit",o.options.cssProgress&&(!0===t?r.classList.add(o.options.cssProgress):r.classList.remove(o.options.cssProgress))),i&&(i.innerHTML=s)},o.setInProgress=function(){o.change(o.options.iconProgress,o.options.textProgress,!0)},o.setSuccess=function(){o.change(o.options.iconSuccess,o.options.textSuccess,!1,"green")},o.setError=function(){o.change(o.options.iconError,o.options.textError,!1,"red")},o}});