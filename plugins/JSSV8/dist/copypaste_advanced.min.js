/**
 * Plugin copy paste advance for jSpreadsheet
 *
 * @version 3.1.0
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @description upgrade copy paste function for work with clipboard permission denied or error
 * and add button on toolbar copy/cut/paste
 *
 * @license This plugin is distribute under MIT License
 *
 * ReleaseNote
 * 3.1 : Add option position_toolbar
 * 3.0 : version for v8
 * 2.1. : add topmenu compatibility
 * 2.0.1 : transform jexcel to jspreadsheet
 * 2.0 : compatibility NPM + add special paste (paste only value, paste only style, paste style from clipboard)
*/ if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jss_copypaste_advanced=e()}(this,function(){return function(t,e){let n=this;if(!n)throw Error("JSpreadsheet must loaded before");if(8>parseInt(n.version().version.split(".")[0]))return console.error('Plugin "Copy paste advanced" not compatible with jspreadsheet '+n.version().version+", Please use an older version of this plugin compatible. Go to https://github.com/GBonnaire/jspreadsheet-plugins-and-editors/"),{};var o={};o.options=Object.assign({},e);var l={allow_pastestyle:!0,text_paste_special:jSuites.translate("Paste special"),text_paste_only_style:jSuites.translate("Paste only format"),text_paste_only_value:jSuites.translate("Paste only value"),position_toolbar:null};for(var r in null==o.options&&(o.options={}),l)o.options.hasOwnProperty(r)&&null!=o.options[r]||(o.options[r]=l[r]);function s(t,e){if(null==e&&(e=n.current),"string"==typeof t){var o=document.createElement("div");o.innerHTML=t,t=o}var l=t.querySelector("table"),r={};if(l){for(var s=parseInt(n.current.selectedCell[0]),a=parseInt(n.current.selectedCell[1]),c=t.querySelector("style"),p=l.querySelectorAll("tbody tr"),u=0;u<p.length;u++)for(var d=p[u].querySelectorAll("td"),y=0;y<d.length;y++){var f=d[y];if(c)var b=i(f,c.innerHTML);else var b=i(f,null);r[n.helpers.getColumnNameFromCoords(s+y,a+u)]=b}e.setStyle(r,null,null,!0)}}function i(t,e){if(t.style.cssText)var n=t.style.cssText+";";else var n="";if(e)for(var o=0;o<t.classList.length;o++){var l=RegExp("\\."+t.classList[o]+"\\s*{([^}]+)}","gm").exec(e);l&&(n+=l=(l=l[1]).replace(/\s+/gm," "))}return n}if(o.init=function(t){},o.contextMenu=function(t,e,l,r,s,i,a,c){var p=!1,u=-1;for(var d in s){var y=s[d];if(y.title==jSuites.translate("Paste")){y.onclick=function(){t.selectedCell&&o.paste()},p=!0;break}y.title==jSuites.translate("Copy")&&(u=parseInt(d))}if(!p&&-1!=u&&(n.dataCopied||navigator&&navigator.clipboard)){var f={title:jSuites.translate("Paste"),icon:"content_paste",shortcut:"Ctrl + V",onclick:function(){t.selectedCell&&(o.options.allow_pastestyle?o.paste():o.pasteOnlyValue())}};s.splice(u+1,0,f)}if(o.options.allow_pastestyle&&-1!=u&&(n.styleCopied||navigator&&navigator.clipboard)){var b={title:o.options.text_paste_special,submenu:[{title:o.options.text_paste_only_value,onclick:function(){t.selectedCell&&o.pasteOnlyValue()}},{title:o.options.text_paste_only_style,onclick:function(){t.selectedCell&&o.pasteOnlyStyle()}}]};s.splice(u+2,0,b)}return s},o.topMenu=function(t,e,l,r){if("Edit"==t){var s=!1,i=-1;for(var a in e){var c=e[a];if(c.title==jSuites.translate("Paste")){c.onclick=function(){n.current.selectedCell&&o.paste()},s=!0;break}c.title==jSuites.translate("Copy")&&(i=parseInt(a))}if(!s&&-1!=i&&(n.dataCopied||navigator&&navigator.clipboard)){var p={title:jSuites.translate("Paste"),icon:"content_paste",shortcut:r+" V",onclick:function(){n.current.selectedCell&&(o.options.allow_pastestyle?o.paste():o.pasteOnlyValue())}};e.splice(i+1,0,p)}if(o.options.allow_pastestyle&&-1!=i&&(n.styleCopied||navigator&&navigator.clipboard)){var u={title:o.options.text_paste_special,submenu:[{title:o.options.text_paste_only_value,onclick:function(){n.current.selectedCell&&o.pasteOnlyValue()}},{title:o.options.text_paste_only_style,onclick:function(){n.current.selectedCell&&o.pasteOnlyStyle()}}]};e.splice(i+2,0,u)}}return e},o.toolbar=function(t){if(!1===o.options.position_toolbar)return t;var e={type:"i",content:"content_paste",onclick:function(){n.current.selectedCell&&o.paste()}},l={type:"i",content:"content_cut",onclick:function(){n.current.selectedCell&&n.current.copy(!0)}},r={type:"i",content:"content_copy",onclick:function(){n.current.selectedCell&&n.current.copy()}};if(null!==o.options.position_toolbar)t.items.splice(parseInt(o.options.position_toolbar)+1,0,e),t.items.splice(parseInt(o.options.position_toolbar)+1,0,r),t.items.splice(parseInt(o.options.position_toolbar)+1,0,l);else for(var s in t.items)if("divisor"==t.items[s].type){t.items.splice(parseInt(s)+1,0,{type:"divisor"}),t.items.splice(parseInt(s)+1,0,e),t.items.splice(parseInt(s)+1,0,r),t.items.splice(parseInt(s)+1,0,l);break}return t},o.onevent=function(t){if("oncopy"==t){n.dataCopied=arguments[3];var e=arguments[1],l=arguments[2];if(o.options.allow_pastestyle&&e.options.style){for(var r=parseInt(l[0]),s=parseInt(l[1]),i=parseInt(l[2]),a=parseInt(l[3]),c=[],p=s;p<=a;p++){for(var u=[],d=r;d<=i;d++){var y=n.helpers.getColumnNameFromCoords(d,p);u.push(e.options.style[y])}c.push(u)}n.styleCopied=c}else n.styleCopied=null}},o.copy=function(t){if(n.current)return n.current.copy(t)},o.paste=function(t){null==t&&(t=!1);var e=parseInt(n.current.selectedCell[0]),l=parseInt(n.current.selectedCell[1]);if(navigator&&navigator.clipboard&&navigator.clipboard.read)navigator.clipboard.read().then(function(r){r[0].getType("text/plain").then(function(r){return new Response(r).text().then(function(r){if(t||!o.options.allow_pastestyle){var s=n.current.borders.copying;n.current.borders.copying=null}r&&n.current.paste(e,l,r),(t||!o.options.allow_pastestyle)&&(n.current.borders.copying=s)})}),o.options.allow_pastestyle&&!t&&r[0].getType("text/html").then(function(t){return new Response(t).text().then(function(t){s(t)})})}).catch(function(r){if(n.dataCopied){if(t||!o.options.allow_pastestyle){var s=n.current.borders.copying;n.current.borders.copying=null}n.current.paste(e,l,n.dataCopied),(t||!o.options.allow_pastestyle)&&(n.current.borders.copying=s)}o.options.allow_pastestyle&&!t&&!n.current.borders.copying&&n.styleCopied&&o.pasteOnlyStyle()});else if(n.dataCopied){if(t||!o.options.allow_pastestyle){var r=n.current.borders.copying;n.current.borders.copying=null}n.current.paste(e,l,n.dataCopied),(t||!o.options.allow_pastestyle)&&(n.current.borders.copying=r),o.options.allow_pastestyle&&!t&&!n.current.borders.copying&&n.styleCopied&&o.pasteOnlyStyle()}},o.pasteOnlyStyle=function(){var t=null;if(n.current.borders.copying){var e=[n.current.borders.copying.x1,n.current.borders.copying.y1,n.current.borders.copying.x2,n.current.borders.copying.y2];if(n.current.options.style){for(var o=parseInt(e[0]),l=parseInt(e[1]),r=parseInt(e[2]),i=parseInt(e[3]),a=[],c=l;c<=i;c++){for(var p=[],u=o;u<=r;u++){var d=n.helpers.getColumnNameFromCoords(u,c);p.push(n.current.options.style[d])}a.push(p)}t=a}}else navigator&&navigator.clipboard?navigator.clipboard.read().then(function(t){t[0].getType("text/html").then(function(t){return new Response(t).text().then(function(t){s(t)})})}):t=n.styleCopied;if(t){for(var u=parseInt(n.current.selectedCell[0]),c=parseInt(n.current.selectedCell[1]),y={},f=0;f<t.length;f++)for(var p=t[f],b=0;b<p.length;b++){var a=p[b],d=n.helpers.getColumnNameFromCoords(u+b,c+f);y[d]=a}n.current.setStyle(y,null,null,!0)}},o.pasteOnlyValue=function(){o.paste(!0)},o.options.allow_pastestyle){var a=n.events.paste;n.events.paste=function(t){if(a(t),n.current&&n.current.selectedCell&&!n.current.edition){if(t&&t.clipboardData&&t.clipboardData.types&&t.clipboardData.getData){if(t.clipboardData.types instanceof DOMStringList&&t.clipboardData.types.contains("text/html")||t.clipboardData.types.indexOf&&-1!==t.clipboardData.types.indexOf("text/html")){var e=t.clipboardData.getData("text/html");s(e)}}else if(window.clipboardData&&window.clipboardData.types&&window.clipboardData.getData){if(window.clipboardData.types instanceof DOMStringList&&window.clipboardData.types.contains("text/html")||window.clipboardData.types.indexOf&&-1!==window.clipboardData.types.indexOf("text/html")){var e=window.clipboardData.getData("text/html");s(e)}}else navigator&&navigator.clipboard&&navigator.clipboard.read&&navigator.clipboard.read().then(function(t){t[0].getType("text/html").then(function(t){return new Response(t).text().then(function(t){s(t)})})})}}}return o}});