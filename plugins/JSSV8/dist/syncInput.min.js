/**
 * Plugin for sync data (json) in jSpreadsheet pro in input
 *
 * @version 2.2.0
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @description sync data (json) in JSpreadsheet in input
 * ReleaseNote:
 * 2.2 : Migrate on JSS v10
 * 2.1 : Manage multiple worksheets
 * 2.0 : Migrate on JSS v8
 * @license This plugin is distribute under MIT License
 */ if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");if(!jspreadsheet&&"function"==typeof require)var jspreadsheet=require("jspreadsheet");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jss_syncInput=t()}(this,function(){return function(e,t,n){let o={};o.options=Object.assign({},t);let i={inputElement:null,inputId:null,checkRow:null,fieldsRequired:[],processedValues:!0,worksheetId:null};for(let s in null==o.options&&(o.options={}),i)o.options.hasOwnProperty(s)&&null!=o.options[s]||(o.options[s]=i[s]);function l(e){if(null==e)return;let t=[],n=e.worksheets;for(let i of n)t.push(i.getJson(!1,o.options.processedValues));let s=[];for(let l=0;l<t.length;l++){if(1==t[l].length){let p=!0;for(let u in t[0])if(t[l][0][u]){p=!1;break}p&&(t[l]=[[]])}s[l]=[];for(let r=0;r<t[l].length;r++){let f=t[l][r];if(Array.isArray(f)&&""===f.join("")||!Array.isArray(f)&&""===Object.values(f).join(""))continue;let d=!0;for(let h=0;h<o.options.fieldsRequired.length;h++){let a=o.options.fieldsRequired[h];if(null==f[a]||""==f[a]){d=!1;break}}d&&("function"==typeof o.options.checkRow&&(d=o.options.checkRow(f,n[l],r,l)),d&&s[l].push(f))}}"textarea"==o.options.inputElement.tagName||"input"==o.options.inputElement.tagName?o.options.inputElement.value=JSON.stringify(s):o.options.inputElement.textContent=JSON.stringify(s)}function p(){o.options.inputId||function t(n){null==n&&(n=""),e.el.id?o.options.inputId=e.el.id+"_DATA"+n:o.options.inputId="JSS_DATA"+n,document.getElementById(o.options.inputId)&&(""==n&&(n=0),t(parseInt(n)+1))}();var t=o.options.inputId,n=document.getElementById(t);if(n)o.options.inputElement=n;else{var i=document.createElement("input");i.id=t,i.name=t,i.type="hidden",e.el.append(i),o.options.inputElement=i}}function u(e){let t=e.options.worksheetId;return""===t&&(t=jSuites.guid(),e.options.worksheetId=t),t}return o.onevent=function(t,n){"onload"==t?(function t(){if(!o.options.inputElement){if(o.options.inputId){let n=document.getElementById(o.options.inputId);n?o.options.inputElement=n:p()}else p()}let i=function t(){if(null===o.options.worksheetId&&1==e.worksheets.length)return e.worksheets[0];if(o.options.worksheetId)for(let n=0;n<e.worksheets.length;n++){var i=e.worksheets[n];if(o.options.worksheetId===u(i))return i}return null}();for(let s=0;s<o.options.fieldsRequired.length;s++){let l=o.options.fieldsRequired[s];if(parseInt(l)+""==l+""){let r=i.options.columns[parseInt(l)].name;r&&(o.options.fieldsRequired[s]=r)}}}(),l(n)):"onchange"==t&&o.options.inputElement&&(null==o.options.worksheetId||"string"==typeof o.options.worksheetId&&u(n)==o.options.worksheetId||Array.isArray(o.options.worksheetId)&&u(n) in o.options.worksheetId)&&l(n.parent)},o}});