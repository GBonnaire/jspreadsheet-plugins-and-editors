/**
 * Plugin statusbar for JSpreadsheet Pro
 *
 * @version 2.7.1
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @summary Add status bar on bottom of JSpreadsheet
 * @namespace jss_statusbar
 *
 * @requires Formula or Formula-Pro
 *
 * @property {Object} options - List options of plugin
 * @property {Boolean|String} [options.showAddRowButton=true] - Add button on right of bar for add row (value : true / false / "after" / "before")
 * @property {Boolean|String} [options.showAddColButton=true] - Add button on right of bar for add col (value : true / false / "after" / "before")
 * @property {Boolean} [options.showAddCalculateButton=false] - Alwayse show calculate button
 * @property {Boolean} [options.closeInsertionOnly=false] - option to defined behavior insertion method
 * @property {Boolean} [options.autoButtonDisable=true] - option to defined behavior action bar
 * @property {int} [options.limitCalculation=0] - Option to set limit cells count autostart calculation (0 = no limit)
 * @property {String} [options.label="Add"] - Label for button action
 * @property {String} [options.labelTooMuchData="Too much data"] - Label for button status too much data
 * @property {String} [options.labelButtonCalculate="Calculate"] - Label for button calculate
 * @property {int} [options.defaultQuantity=10] - Quantity for button action
 * @property {Object} [options.formulas] - Formulas showed on statusbar. object.key = title of formula, object.value = formula. In formula you can use this shortcut {range} (Ref to range selected), {cells} (Ref to array of cells selected), {x1} (Ref to start col of selection), {y1} (Ref to start row of selection), {x2} (Ref to end col to selection), {y2} (Ref to end row to selection), or function(instance, parameters(range, cells, x1, y1, x2, y2), values)
 *
 * @link https://github.com/GBonnaire/jspreadsheet-plugins-and-editors/blob/master/plugins/JSSV8/src/statusbar/README.mdgithub
 * Documentation official
 *
 * @example
 * jexcel(document.getElementById('spreadsheet'), {
 *	plugins: [
 *       { name:'statusBar', plugin:jss_statusbar },
 *     ],
 * });
 * @license This plugin is distributed under MIT License
 *
 * @description Status bar is a plugin for add a status bar on bottom of the sheet like Excel. On this status bar you can add new row with button, and show information on selection (Range selected, Formulas, etc.)
 * Release notes
 * Version 2.7.0: Migration to v10
 * Version 2.6.0: Add limit calculation
 * Version 2.5.0: Add support function on formula
 * Version 2.4.0: Add disabled buttons features + event
 * Version 2.3.6: Fix #18
 * Version 2.3.5: Fix #17
 * Version 2.3.4: Fix #16
 * Version 2.3.3: Manage after change cell content
 * Version 2.3.2: Add property closeInsertionOnly + auto scroll
 * Version 2.3.1: Add property quantity
 * Version 2.3.0: Add possibility to insert after/before row/column
 * Version 2.2.1: Fix style and checker empty selection, add property
 * Version 2.2.0: Add possibility to add column
 * Version 2.1.1: Fix error build on webpack
 * Version 2.1.0: add compatibility v9
 * Version 2.0.1: compatibility ES6
 * Version 2.0.0: migration v8
 * Version 1.3.2: Fix compatibility
 * Version 1.3.1: Transform jexcel to jspreadsheet
 * Version 1.3.0: Compatibility for project dev in ES2015
 * Version 1.2.1: Fix bug with fullscreen + bug formula with 1 cell
 * Version 1.2.0: Add formula execute by cells selected (i.e. with results)
 */
documentif(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.jss_statusbar=e()}(this,function(){return function(t,e,o){let n=this;if(!n)throw Error("JSpreadsheet must loaded before");let s=n.formula;if(!s)throw Error("Statusbar plugin require formula extension on JSpreadsheet");let l={},i={},a=null;l.options=Object.assign({},e);let r={showAddRowButton:!0,showAddColButton:!0,showAddCalculateButton:!1,closeInsertionOnly:!1,autoButtonDisable:!0,limitCalculation:0,formulas:{Range:"{range}",SUM:"=SUM({range})",MAX:"=MAX({range})",MIN:"=MIN({range})"},label:jSuites.translate("Add"),labelTooMuchData:jSuites.translate("Too much data"),labelButtonCalculate:jSuites.translate("Calculate"),defaultQuantity:10};for(var u in null==l.options&&(l.options={}),r)l.options.hasOwnProperty(u)&&null!=l.options[u]||(l.options[u]=r[u]);for(let _ in l.options.formulas)"string"==typeof l.options.formulas[_]&&"="==l.options.formulas[_].substring(0,1)&&(l.options.formulas[_]=n.helpers.secureFormula(l.options.formulas[_]));function d(t,e){for(let o in e)t=t.replace(RegExp("{[ ]?"+o+"[ ]?}","gi"),e[o]);return t}function c(){return n.current?n.current:null!=t.getWorksheetActive()?t.worksheets[t.getWorksheetActive()]:t.worksheets[0]}function p(t){return("object"!=typeof t||Array.isArray(t)||(t=Object.values(t)),"object"==typeof t&&Array.isArray(t))?0==t.length?0:1==t.length?parseInt(t[0]):parseInt(Math.max(...t)):parseInt(t)}function $(t){return("object"!=typeof t||Array.isArray(t)||(t=Object.values(t)),"object"==typeof t&&Array.isArray(t))?0==t.length?0:1==t.length?parseInt(t[0]):parseInt(Math.min(...t)):parseInt(t)}return l.onevent=function(t,e){var o,n;if("onload"==t)l.createStatusbar(e),e.dispatch("statusbar_onload",e,i);else if("onselection"==t){let s=arguments[2],r=arguments[3],u=arguments[4],_=arguments[5];a=[s,r,u,_],l.generateInformation()}else"onafterchanges"==t?l.generateInformation():"onblur"==t&&i.informationBar&&(i.informationBar.innerHTML="");null==e.selectedCell?(o=e,i.actionBar&&l.options.autoButtonDisable&&!i.actionBar.classList.contains("disabled")&&l.options.closeInsertionOnly&&(i.actionBar.classList.add("disabled"),"function"==typeof o.dispatch&&o.dispatch("statusbar_buttons_disable",o,i))):(n=e,i.actionBar&&l.options.autoButtonDisable&&i.actionBar.classList.contains("disabled")&&(i.actionBar.classList.remove("disabled"),"function"==typeof n.dispatch&&n.dispatch("statusbar_buttons_enable",n,i)))},l.createStatusbar=function(t){let e=t.element,o=e.querySelector(":scope > .jtabs-content"),n=document.createElement("div");i.statusBar=n,n.classList.add("jss_statusbar");let s=document.createElement("div");i.actionBar=s,s.classList.add("jss_statusbar_addaction"),l.options.showAddRowButton||l.options.showAddColButton||(s.style.display="none");let a=document.createElement("input");i.quantity=a,a.setAttribute("type","number"),a.setAttribute("min","1"),a.setAttribute("step","1"),a.addEventListener("keydown",function(t){t.stopPropagation()}),a.value=l.options.defaultQuantity;let r=document.createElement("button");r.innerHTML='<svg style="width:15px;height:15px" viewBox="0 0 24 24"> <path fill="currentColor" d="M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z" /></svg>',r.onclick=function(t){if(!0===l.options.showAddRowButton||"after"==l.options.showAddRowButton){let e=c();e.options.allowInsertRow&&(1==e.getSelectedRows(!0).length&&e.getSelectedColumns().length==e.options.data[0].length||l.options.closeInsertionOnly?e.selectedCell&&e.insertRow(parseInt(a.value),p(e.getSelectedRows(!0))):(e.goto(e.options.data.length,$(e.getSelectedColumns())),e.insertRow(parseInt(a.value))))}};let u=document.createElement("button");u.innerHTML='<svg style="width:15px;height:15px;transform: rotate(180deg);" viewBox="0 0 24 24"> <path fill="currentColor" d="M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z" /></svg>',u.onclick=function(t){if(!0===l.options.showAddRowButton||"before"==l.options.showAddRowButton){let e=c();e.options.allowInsertRow&&(1==e.getSelectedRows(!0).length&&e.getSelectedColumns().length==e.options.data[0].length||l.options.closeInsertionOnly?e.selectedCell&&e.insertRow(parseInt(a.value),$(e.getSelectedRows(!0)),!0):(e.goto(0,$(e.getSelectedColumns())),e.insertRow(parseInt(a.value),0,!0)))}};let _=document.createElement("button");_.innerHTML='<svg style="width:15px;height:15px" viewBox="0 0 24 24"><path fill="currentColor" d="M11,2A2,2 0 0,1 13,4V20A2,2 0 0,1 11,22H2V2H11M4,10V14H11V10H4M4,16V20H11V16H4M4,4V8H11V4H4M15,11H18V8H20V11H23V13H20V16H18V13H15V11Z" /></svg>',_.onclick=function(t){if(!0===l.options.showAddColButton||"after"==l.options.showAddColButton){let e=c();e.options.allowInsertColumn&&(1==e.getSelectedColumns().length&&e.getSelectedRows(!0).length==e.options.data.length||l.options.closeInsertionOnly?e.selectedCell&&e.insertColumn(parseInt(a.value),p(e.getSelectedColumns())):(e.goto($(e.getSelectedRows(!0)),e.options.data[0].length),e.insertColumn(parseInt(a.value))))}};let d=document.createElement("button");d.innerHTML='<svg style="width:15px;height:15px;transform: rotate(180deg);" viewBox="0 0 24 24"><path fill="currentColor" d="M11,2A2,2 0 0,1 13,4V20A2,2 0 0,1 11,22H2V2H11M4,10V14H11V10H4M4,16V20H11V16H4M4,4V8H11V4H4M15,11H18V8H20V11H23V13H20V16H18V13H15V11Z" /></svg>',d.onclick=function(t){if(!0===l.options.showAddColButton||"before"==l.options.showAddColButton){let e=c();e.options.allowInsertColumn&&(1==e.getSelectedColumns().length&&e.getSelectedRows(!0).length==e.options.data.length||l.options.closeInsertionOnly?e.selectedCell&&e.insertColumn(parseInt(a.value),$(e.getSelectedColumns()),!0):(e.goto($(e.getSelectedRows(!0)),0),e.insertColumn(parseInt(a.value),0,!0)))}};let f=document.createElement("span");i.labelAdd=f,f.innerHTML=l.options.label,s.appendChild(f),s.appendChild(a),!1!==l.options.showAddRowButton&&((!0===l.options.showAddRowButton||"before"==l.options.showAddRowButton)&&(s.appendChild(u),i.buttonAddRowsBefore=u),(!0===l.options.showAddRowButton||"after"==l.options.showAddRowButton)&&(s.appendChild(r),i.buttonAddRows=r)),!1!==l.options.showAddColButton&&((!0===l.options.showAddColButton||"before"==l.options.showAddColButton)&&(s.appendChild(d),i.buttonAddColsBefore=d),(!0===l.options.showAddColButton||"after"==l.options.showAddColButton)&&(s.appendChild(_),i.buttonAddCols=_)),n.appendChild(s);let h=document.createElement("div");h.classList.add("jss_statusbar_information"),i.informationBar=h,n.appendChild(h),o.after(n)},l.generateInformation=function(t=!1){let e="",o=!1,s=c(),r=""==s.getData(!0).join("").replace(/,/gm,"");if(null==a&&(a=s.selectedCell),a){let u=n.helpers.getColumnNameFromCoords(a[0],a[1]),_;_=a[0]!=a[2]||a[1]!=a[3]?n.helpers.getColumnNameFromCoords(a[2],a[3]):"";let p={};if(p.range=u+(""!=_?":"+_:""),p.cells=function(t){let e=[],o=t.split(":");if(!o[1])return"["+o[0]+"]";let l=n.helpers.getCoordsFromColumnName(o[0]),i=n.helpers.getCoordsFromColumnName(o[1]),a,r,u,_;l[0]<=i[0]?(a=l[0],r=i[0]):(a=i[0],r=l[0]),l[1]<=i[1]?(u=l[1],_=i[1]):(u=i[1],_=l[1]);for(let d=u;d<=_;d++)for(let c=a;c<=r;c++)(null==s.results||-1!=s.results.indexOf(d))&&e.push(n.helpers.getColumnNameFromCoords(c,d));return"["+e.join(",")+"]"}(p.range),p.x1=parseInt(a[0]),p.y1=parseInt(a[1]),p.x2=parseInt(a[2]),p.y2=parseInt(a[3]),t||l.options.limitCalculation<=0||null!=s.getSelected()&&s.getSelected().length<=l.options.limitCalculation){for(let $ in l.options.formulas){let f=l.options.formulas[$];if("string"==typeof f){if("="===f.substring(0,1)){if(!r){""!=e&&(e+="<span class='divisor'></span>");let h=s.executeFormula(d(f,p));null!==h&&(e+=$+" : "+h)}}else""!=e&&(e+="<span class='divisor'></span>"),e+=$+" : "+d(f,p)}else if("function"==typeof f){""!=e&&(e+="<span class='divisor'></span>");let g=f(s,p,s.getJson(!0,!0));null!==g&&(e+=$+" : "+g)}}a=null}else e=l.options.labelTooMuchData,o=!0}if(i.informationBar&&(i.informationBar.innerHTML=e,o||l.options.showAddCalculateButton)){let m=document.createElement("button");m.classList.add("jss-statusbar-calculate"),m.innerHTML=l.options.labelButtonCalculate,m.addEventListener("click",t=>{l.generateInformation(!0)}),i.informationBar.append(m)}},l}});