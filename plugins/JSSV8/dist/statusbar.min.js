/**
 * Plugin statusbar for JSpreadsheet Pro
 * 
 * @version 2.3.6
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @summary Add status bar on bottom of JSpreadsheet
 * @namespace jss_statusbar
 * 
 * @requires Formula or Formula-Pro
 * 
 * @property {Object} options - List options of plugin
 * @property {Boolean|String} [options.showAddRowButton=true] - Add button on right of bar for add row (value : true / false / "after" / "before")
 * @property {Boolean|String} [options.showAddColButton=true] - Add button on right of bar for add col (value : true / false / "after" / "before")
 * @property {Boolean} [options.closeInsertionOnly=false] - option to defined behavior insertion method
 * @property {String} [options.label="Add"] - Label for button action
 * @property {int} [options.defaultQuantity=10] - Quantity for button action
 * @property {Object} [options.formulas] - Formulas showed on statusbar. object.key = title of formula, object.value = formula. In formula you can use this shortcut {range} (Ref to range selected), {cells} (Ref to array of cells selected), {x1} (Ref to start col of selection), {y1} (Ref to start row of selection), {x2} (Ref to end col to selection), {y2} (Ref to end row to selection)
 * 
 * @link https://github.com/GBonnaire/jspreadsheet-plugins-and-editors/blob/master/plugins/JSSV8/src/statusbar/README.mdgithub
 * Documentation official
 * 
 * @example 
 * jexcel(document.getElementById('spreadsheet'), {
 *	plugins: [
 *       { name:'statusBar', plugin:jss_statusbar },
 *     ],
 * });
 * @license This plugin is distributed under MIT License
 * 
 * @description Status bar is a plugin for add a status bar on bottom of the sheet like Excel. On this status bar you can add new row with button, and show information on selection (Range selected, Formulas, etc.)
 * Release notes
 * Version 2.3.6: Fix #18
 * Version 2.3.5: Fix #17
 * Version 2.3.4: Fix #16
 * Version 2.3.3: Manage after change cell content
 * Version 2.3.2: Add property closeInsertionOnly + auto scroll
 * Version 2.3.1: Add property quantity
 * Version 2.3.0: Add possibility to insert after/before row/column
 * Version 2.2.1: Fix style and checker empty selection, add property
 * Version 2.2.0: Add possibility to add column
 * Version 2.1.1: Fix error build on webpack
 * Version 2.1.0: add compatibility v9
 * Version 2.0.1: compatibility ES6
 * Version 2.0.0: migration v8
 * Version 1.3.2: Fix compatibility
 * Version 1.3.1: Transform jexcel to jspreadsheet
 * Version 1.3.0: Compatibility for project dev in ES2015
 * Version 1.2.1: Fix bug with fullscreen + bug formula with 1 cell
 * Version 1.2.0: Add formula execute by cells selected (i.e. with results)
 */
if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jss_statusbar=t()}(this,function(){return function(e,t,o){let n=this;if(!n)throw Error("JSpreadsheet must loaded before");let l=n.formula;if(!l)throw Error("Statusbar plugin require formula extension on JSpreadsheet");let s={},i=null,r=null;s.options=Object.assign({},t);let _={showAddRowButton:!0,showAddColButton:!0,closeInsertionOnly:!1,formulas:{Range:"{range}",SUM:"=SUM({range})",MAX:"=MAX({range})",MIN:"=MIN({range})"},label:jSuites.translate("Add"),defaultQuantity:10};for(var a in null==s.options&&(s.options={}),_)s.options.hasOwnProperty(a)&&null!=s.options[a]||(s.options[a]=_[a]);function u(e,t){for(let o in t)e=e.replace(RegExp("{[ ]?"+o+"[ ]?}","gi"),t[o]);return e}function d(){return r.querySelector(".jss_statusbar_information")}function $(){return n.current?n.current:null!=e.getWorksheetActive()?e.worksheets[e.getWorksheetActive()]:e.worksheets[0]}function p(e){return("object"!=typeof e||Array.isArray(e)||(e=Object.values(e)),"object"==typeof e&&Array.isArray(e))?0==e.length?0:1==e.length?parseInt(e[0]):parseInt(Math.max(...e)):parseInt(e)}function c(e){return("object"!=typeof e||Array.isArray(e)||(e=Object.values(e)),"object"==typeof e&&Array.isArray(e))?0==e.length?0:1==e.length?parseInt(e[0]):parseInt(Math.min(...e)):parseInt(e)}return s.onevent=function(e,t){if("onload"==e)s.createStatusbar(t);else if("onselection"==e){let o=arguments[2],n=arguments[3],l=arguments[4],r=arguments[5];i=[o,n,l,r],s.generateInformation()}else if("onafterchanges"==e)s.generateInformation();else if("onblur"==e){let _=d();_&&(_.innerHTML="")}},s.createStatusbar=function(e){let t=e.element,o=t.querySelector(":scope > .jtabs-content");(r=document.createElement("div")).classList.add("jss_statusbar");let n=document.createElement("div");n.classList.add("jss_statusbar_addaction"),s.options.showAddRowButton||s.options.showAddColButton||(n.style.display="none");let l=document.createElement("input");l.setAttribute("type","number"),l.setAttribute("min","1"),l.setAttribute("step","1"),l.addEventListener("keydown",function(e){e.stopPropagation()}),l.value=s.options.defaultQuantity;let i=document.createElement("button");i.innerHTML='<svg style="width:15px;height:15px" viewBox="0 0 24 24"> <path fill="currentColor" d="M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z" /></svg>',i.onclick=function(e){if(!0===s.options.showAddRowButton||"after"==s.options.showAddRowButton){let t=$();t.options.allowInsertRow&&(1==t.getSelectedRows(!0).length&&t.getSelectedColumns().length==t.options.data[0].length||s.options.closeInsertionOnly?t.selectedCell&&t.insertRow(parseInt(l.value),p(t.getSelectedRows(!0))):(t.goto(t.options.data.length,c(t.getSelectedColumns())),t.insertRow(parseInt(l.value))))}};let _=document.createElement("button");_.innerHTML='<svg style="width:15px;height:15px;transform: rotate(180deg);" viewBox="0 0 24 24"> <path fill="currentColor" d="M22,10A2,2 0 0,1 20,12H4A2,2 0 0,1 2,10V3H4V5H8V3H10V5H14V3H16V5H20V3H22V10M4,10H8V7H4V10M10,10H14V7H10V10M20,10V7H16V10H20M11,14H13V17H16V19H13V22H11V19H8V17H11V14Z" /></svg>',_.onclick=function(e){if(!0===s.options.showAddRowButton||"before"==s.options.showAddRowButton){let t=$();t.options.allowInsertRow&&(1==t.getSelectedRows(!0).length&&t.getSelectedColumns().length==t.options.data[0].length||s.options.closeInsertionOnly?t.selectedCell&&t.insertRow(parseInt(l.value),c(t.getSelectedRows(!0)),!0):(t.goto(0,c(t.getSelectedColumns())),t.insertRow(parseInt(l.value),0,!0)))}};let a=document.createElement("button");a.innerHTML='<svg style="width:15px;height:15px" viewBox="0 0 24 24"><path fill="currentColor" d="M11,2A2,2 0 0,1 13,4V20A2,2 0 0,1 11,22H2V2H11M4,10V14H11V10H4M4,16V20H11V16H4M4,4V8H11V4H4M15,11H18V8H20V11H23V13H20V16H18V13H15V11Z" /></svg>',a.onclick=function(e){if(!0===s.options.showAddColButton||"after"==s.options.showAddColButton){let t=$();t.options.allowInsertColumn&&(1==t.getSelectedColumns().length&&t.getSelectedRows(!0).length==t.options.data.length||s.options.closeInsertionOnly?t.selectedCell&&t.insertColumn(parseInt(l.value),p(t.getSelectedColumns())):(t.goto(c(t.getSelectedRows(!0)),t.options.data[0].length),t.insertColumn(parseInt(l.value))))}};let u=document.createElement("button");u.innerHTML='<svg style="width:15px;height:15px;transform: rotate(180deg);" viewBox="0 0 24 24"><path fill="currentColor" d="M11,2A2,2 0 0,1 13,4V20A2,2 0 0,1 11,22H2V2H11M4,10V14H11V10H4M4,16V20H11V16H4M4,4V8H11V4H4M15,11H18V8H20V11H23V13H20V16H18V13H15V11Z" /></svg>',u.onclick=function(e){if(!0===s.options.showAddColButton||"before"==s.options.showAddColButton){let t=$();t.options.allowInsertColumn&&(1==t.getSelectedColumns().length&&t.getSelectedRows(!0).length==t.options.data.length||s.options.closeInsertionOnly?t.selectedCell&&t.insertColumn(parseInt(l.value),c(t.getSelectedColumns()),!0):(t.goto(c(t.getSelectedRows(!0)),0),t.insertColumn(parseInt(l.value),0,!0)))}};let d=document.createElement("span");d.innerHTML=s.options.label,n.appendChild(d),n.appendChild(l),!1!==s.options.showAddRowButton&&((!0===s.options.showAddRowButton||"before"==s.options.showAddRowButton)&&n.appendChild(_),(!0===s.options.showAddRowButton||"after"==s.options.showAddRowButton)&&n.appendChild(i)),!1!==s.options.showAddColButton&&((!0===s.options.showAddColButton||"before"==s.options.showAddColButton)&&n.appendChild(u),(!0===s.options.showAddColButton||"after"==s.options.showAddColButton)&&n.appendChild(a)),r.appendChild(n);let h=document.createElement("div");h.classList.add("jss_statusbar_information"),r.appendChild(h),o.after(r)},s.generateInformation=function(){let e="",t=$(),o=""==t.getData(!0).join("").replace(/,/gm,"");if(null==i&&(i=t.selectedCell),i){let l=n.helpers.getColumnNameFromCoords(i[0],i[1]),r;r=i[0]!=i[2]||i[1]!=i[3]?n.helpers.getColumnNameFromCoords(i[2],i[3]):"";let _={};for(let a in _.range=l+(""!=r?":"+r:""),_.cells=function(e){let o=[],l=e.split(":");if(!l[1])return"["+l[0]+"]";let s=n.helpers.getCoordsFromColumnName(l[0]),i=n.helpers.getCoordsFromColumnName(l[1]),r,_,a,u;s[0]<=i[0]?(r=s[0],_=i[0]):(r=i[0],_=s[0]),s[1]<=i[1]?(a=s[1],u=i[1]):(a=i[1],u=s[1]);for(let d=a;d<=u;d++)for(let $=r;$<=_;$++)(null==t.results||-1!=t.results.indexOf(d))&&o.push(n.helpers.getColumnNameFromCoords($,d));return"["+o.join(",")+"]"}(_.range),_.x1=parseInt(i[0]),_.y1=parseInt(i[1]),_.x2=parseInt(i[2]),_.y2=parseInt(i[3]),s.options.formulas){let p=s.options.formulas[a];if("="===p.substr(0,1)){if(!o){""!=e&&(e+="<span class='divisor'></span>");let c=t.executeFormula(u(p,_));null!==c&&(e+=a+" : "+c)}}else""!=e&&(e+="<span class='divisor'></span>"),e+=a+" : "+u(p,_)}i=null}let h=d();null!=h&&(h.innerHTML=e)},s}});