/**
 * Plugin statusbar for JSpreadsheet Pro
 * 
 * @version 2.1.3
 * @author Guillaume Bonnaire <contact@gbonnaire.fr>
 * @website https://repo.gbonnaire.fr
 * @summary Add status bar on bottom of JSS
 * @namespace jss_statusbar
 * 
 * @requires Formula or Formula-Pro
 * 
 * @property {Object} options - List options of plugin
 * @property {Boolean} [options.showAddRowButton=false] - Add button on right of bar for add row
 * @property {String} [text_AddRowButton="Add {*} row(s)"] - Text for button, {*} is input field 
 * @property {Object} [options.formulas] - Formulas showed on statusbar. object.key = title of formula, object.value = formula. In formula you can use this shortcut {range} (Ref to range selected), {cells} (Ref to array of cells selected), {x1} (Ref to start col of selection), {y1} (Ref to start row of selection), {x2} (Ref to end col to selection), {y2} (Ref to end row to selection)
 * 
 * @link https://github.com/Guillaume-Bo/jexcel-plugins-and-editors/blob/master/plugins/statusbar/README.md Documentation official
 * 
 * @example 
 * jexcel(document.getElementById('spreadsheet'), {
 *	plugins: [
 *       { name:'statusBar', plugin:jss_statusbar },
 *     ],
 * });
 * @license This plugin is distributed under MIT License
 * 
 * @description Status bar is a plugin for add a status bar on bottom of the sheet like Excel. On this status bar you can add new row with button, and show information on selection (Range selected, Formulas, etc.)
 * Release notes
 * Version 2.1.3: Fix check data in row
 * Version 2.1.2: Fix error build on webpack
 * Version 2.1.1: Fix error build on webpack
 * Version 2.1.0: add compatibility v9
 * Version 2.0.1: compatibility ES6
 * Version 2.0.0: migration v8
 * Version 1.3.2: Fix compatibility
 * Version 1.3.1: Transform jexcel to jspreadsheet
 * Version 1.3.0: Compatibility for project dev in ES2015
 * Version 1.2.1: Fix bug with fullscreen + bug formula with 1 cell
 * Version 1.2.0: Add formula execute by cells selected (i.e. with results)
   */ if(!jSuites&&"function"==typeof require)var jSuites=require("jsuites");!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jss_statusbar=t()}(this,function(){return function(e,t,n){let o=this;if(!o)throw Error("JSpreadsheet must loaded before");let s=o.formula;if(!s)throw Error("Statusbar plugin require formula extension on JSpreadsheet");let r={},l=null,i=null;r.options=Object.assign({},t);let a={showAddRowButton:!0,formulas:{Range:"{range}",SUM:"=SUM({range})",MAX:"=MAX({range})",MIN:"=MIN({range})"},text_AddRowButton:jSuites.translate("Add {*} row(s)")};for(var u in null==r.options&&(r.options={}),a)r.options.hasOwnProperty(u)&&null!=r.options[u]||(r.options[u]=a[u]);function d(e,t){for(let n in t)e=e.replace(RegExp("{[ ]?"+n+"[ ]?}","gi"),t[n]);return e}function p(){return i.querySelector(".jss_statusbar_information")}function f(){return o.current?o.current:null!=e.getWorksheetActive()?e.worksheets[e.getWorksheetActive()]:e.worksheets[0]}return r.onevent=function(e,t){if("onload"==e)r.createStatusbar(t);else if("onselection"==e){let n=arguments[2],o=arguments[3],s=arguments[4],i=arguments[5];l=[n,o,s,i],r.generateInformation()}else if("onblur"==e){let a=p();a&&(a.innerHTML="")}},r.createStatusbar=function(e){let t=e.element,n=t.querySelector(":scope > .jtabs-content");(i=document.createElement("div")).classList.add("jss_statusbar");let o=r.options.text_AddRowButton.split("{*}"),s=document.createElement("div");s.classList.add("jss_statusbar_addrows"),r.options.showAddRowButton||(s.style.display="none");let l=document.createElement("input");l.setAttribute("type","number"),l.setAttribute("min","1"),l.setAttribute("step","1"),l.value=1;let a=document.createElement("button");a.innerHTML=o[0],a.onclick=function(e){if(r.options.showAddRowButton){let t=f();t.options.allowInsertRow&&t.insertRow(parseInt(l.value))}};let u=document.createElement("span");u.innerHTML=o[1],s.appendChild(a),s.appendChild(l),s.appendChild(u),i.appendChild(s);let d=document.createElement("div");d.classList.add("jss_statusbar_information"),i.appendChild(d),n.after(i)},r.generateInformation=function(){let e="",t=f(),n=""==t.getData(!0).join("").replace(/,/gm,"");null==l&&(l=t.selectedCell);let s=o.helpers.getColumnNameFromCoords(l[0],l[1]),i;i=l[0]!=l[2]||l[1]!=l[3]?o.helpers.getColumnNameFromCoords(l[2],l[3]):"";let a={};for(let u in a.range=s+(""!=i?":"+i:""),a.cells=function(e){let n=[],s=e.split(":");if(!s[1])return"["+s[0]+"]";let r=o.helpers.getCoordsFromColumnName(s[0]),l=o.helpers.getCoordsFromColumnName(s[1]),i,a,u,d;r[0]<=l[0]?(i=r[0],a=l[0]):(i=l[0],a=r[0]),r[1]<=l[1]?(u=r[1],d=l[1]):(u=l[1],d=r[1]);for(let p=u;p<=d;p++)for(let f=i;f<=a;f++)(null==t.results||-1!=t.results.indexOf(p))&&n.push(o.helpers.getColumnNameFromCoords(f,p));return"["+n.join(",")+"]"}(a.range),a.x1=parseInt(l[0]),a.y1=parseInt(l[1]),a.x2=parseInt(l[2]),a.y2=parseInt(l[3]),r.options.formulas){let c=r.options.formulas[u];if("="==c.substr(0,1)){if(!n){""!=e&&(e+="<span class='divisor'></span>");let m=t.executeFormula(d(c,a));null!==m&&(e+=u+" : "+m)}}else""!=e&&(e+="<span class='divisor'></span>"),e+=u+" : "+d(c,a)}l=null;let h=p();null!=h&&(h.innerHTML=e)},r}});