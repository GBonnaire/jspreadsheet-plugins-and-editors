var jspreadsheet;jspreadsheet||"function"!=typeof require||(jspreadsheet=require("jspreadsheet-pro")),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.jss_copypaste_advanced=t(),e.jexcel_copypaste_advanced=e.jss_copypaste_advanced}(this,function(){return function(f,e){var t,n,c={},o={allow_pastestyle:!0,text_paste_special:"Paste special",text_paste_only_style:"Paste only format",text_paste_only_value:"Paste only value"};for(t in null==c.options&&(c.options={}),o)c.options.hasOwnProperty(t)&&null!=c.options[t]||(c.options[t]=o[t]),"text_"===t.substring(0,5)&&(n="copypasteadv_"+t.substring(5,t.length),f.options.text[n]&&(c.options[t]=f.options.text[n]));c.contextMenu=function(e,t,n,o,s){var a,l,p=!1,r=-1;for(a in s){var i=s[a];if(i.title==f.options.text.paste){i.onclick=function(){f.selectedCell&&c.paste()},p=!0;break}i.title==f.options.text.copy&&(r=parseInt(a))}return!p&&-1!=r&&(jspreadsheet.dataCopied||navigator&&navigator.clipboard)&&(l={title:e.options.text.paste,shortcut:"Ctrl + V",onclick:function(){f.selectedCell&&(c.options.allow_pastestyle?c.paste():c.pasteOnlyValue())}},s.splice(r+1,0,l)),c.options.allow_pastestyle&&-1!=r&&(jspreadsheet.styleCopied||navigator&&navigator.clipboard)&&(l={title:c.options.text_paste_special,submenu:[{title:c.options.text_paste_only_value,onclick:function(){f.selectedCell&&c.pasteOnlyValue()}},{title:c.options.text_paste_only_style,onclick:function(){f.selectedCell&&c.pasteOnlyStyle()}}]},s.splice(r+2,0,l)),s},c.topMenu=function(e,t,n,o){if("Edit"==e){var s,a,l=!1,p=-1;for(s in t){var r=t[s];if(r.title==f.options.text.paste){r.onclick=function(){f.selectedCell&&c.paste()},l=!0;break}r.title==f.options.text.copy&&(p=parseInt(s))}!l&&-1!=p&&(jspreadsheet.dataCopied||navigator&&navigator.clipboard)&&(a={title:f.options.text.paste,icon:"content_paste",shortcut:o+" V",onclick:function(){f.selectedCell&&(c.options.allow_pastestyle?c.paste():c.pasteOnlyValue())}},t.splice(p+1,0,a)),c.options.allow_pastestyle&&-1!=p&&(jspreadsheet.styleCopied||navigator&&navigator.clipboard)&&(a={title:c.options.text_paste_special,submenu:[{title:c.options.text_paste_only_value,onclick:function(){f.selectedCell&&c.pasteOnlyValue()}},{title:c.options.text_paste_only_style,onclick:function(){f.selectedCell&&c.pasteOnlyStyle()}}]},t.splice(p+2,0,a))}return t},c.toolbar=function(e,t){var n,o={type:"i",content:"content_paste",onclick:function(){f.selectedCell&&c.paste()}},s={type:"i",content:"content_cut",onclick:function(){f.selectedCell&&f.copy(!0)}},a={type:"i",content:"content_copy",onclick:function(){f.selectedCell&&f.copy()}};for(n in t)if("redo"==t[n].content){t.splice(parseInt(n)+1,0,o),t.splice(parseInt(n)+1,0,a),t.splice(parseInt(n)+1,0,s);break}return t},c.onevent=function(e){};var u=f.options.onbeforepaste;f.options.onbeforepaste=function(e,t,n,o){if(null!=u){var s=u(...arguments);if(!1===s)return!1;s&&(t=s)}var a=parseInt(f.selectedCell[2]),s=parseInt(f.selectedCell[3])-o+1,l=t.length,p=t[0].length,r=Math.trunc((a-n+1)/p),i=Math.trunc(s/l);if(0==r||0==i)return t;for(var c=[],d=0;d<l*i;d++){c[d]=[];for(var y=0;y<p*r;y++)c[d][y]=t[d%l][y%p];c[d]=c[d].join("\t")}return c=c.join("\r\n")};var s,d=f.copy;function h(e){"string"==typeof e&&((t=document.createElement("div")).innerHTML=e,e=t);var t=e.querySelector("table"),n={};if(t){for(var o=parseInt(jspreadsheet.current.selectedCell[0]),s=parseInt(jspreadsheet.current.selectedCell[1]),a=e.querySelector("style"),l=t.querySelectorAll("tbody tr"),p=0;p<l.length;p++)for(var r=l[p].querySelectorAll("td"),i=0;i<r.length;i++){var c=r[i];c=y(c,a?a.innerHTML:null),n[jspreadsheet.getColumnNameFromId([o+i,s+p])]=c}jspreadsheet.current.setStyle(n,null,null,!0)}}function y(e,t){var n;if(n=e.style.cssText?e.style.cssText+";":"",t)for(var o=0;o<e.classList.length;o++){var s=e.classList[o],s=new RegExp("\\."+s+"\\s*{([^}]+)}","gm").exec(t);s&&(n+=s=(s=s[1]).replace(/\s+/gm," "))}return n}return f.copy=function(e){var t=d(e);if(jspreadsheet.dataCopied=t,c.options.allow_pastestyle&&f.options.style){for(var n=parseInt(f.selectedCell[0]),e=parseInt(f.selectedCell[1]),o=parseInt(f.selectedCell[2]),s=parseInt(f.selectedCell[3]),a=[],l=e;l<=s;l++){for(var p=[],r=n;r<=o;r++){var i=jspreadsheet.getColumnNameFromId([r,l]);p.push(f.options.style[i])}a.push(p)}jspreadsheet.styleCopied=a}else jspreadsheet.styleCopied=null;return t},c.copy=function(e){return f.copy(e)},c.paste=function(n){null==n&&(n=!1);var e,o=parseInt(f.selectedCell[0]),s=parseInt(f.selectedCell[1]);navigator&&navigator.clipboard?navigator.clipboard.read().then(function(e){e[0].getType("text/plain").then(function(e){return new Response(e).text().then(function(e){var t;!n&&c.options.allow_pastestyle||(t=f.borders.copying,f.borders.copying=null),e&&f.paste(o,s,e),!n&&c.options.allow_pastestyle||(f.borders.copying=t)})}),c.options.allow_pastestyle&&!n&&e[0].getType("text/html").then(function(e){return new Response(e).text().then(function(e){h(e)})})}).catch(function(e){var t;jspreadsheet.dataCopied&&(!n&&c.options.allow_pastestyle||(t=f.borders.copying,f.borders.copying=null),f.paste(o,s,jspreadsheet.dataCopied),!n&&c.options.allow_pastestyle||(f.borders.copying=t)),c.options.allow_pastestyle&&!n&&!f.borders.copying&&jspreadsheet.styleCopied&&c.pasteOnlyStyle()}):jspreadsheet.dataCopied&&(!n&&c.options.allow_pastestyle||(e=f.borders.copying,f.borders.copying=null),f.paste(o,s,jspreadsheet.dataCopied),!n&&c.options.allow_pastestyle||(f.borders.copying=e),c.options.allow_pastestyle&&!n&&!f.borders.copying&&jspreadsheet.styleCopied&&c.pasteOnlyStyle())},c.pasteOnlyStyle=function(){var e=null;if(f.borders.copying){var t=[f.borders.copying.x1,f.borders.copying.y1,f.borders.copying.x2,f.borders.copying.y2];if(f.options.style){for(var n=parseInt(t[0]),o=parseInt(t[1]),s=parseInt(t[2]),a=parseInt(t[3]),l=[],p=o;p<=a;p++){for(var r=[],i=n;i<=s;i++){var c=jspreadsheet.getColumnNameFromId([i,p]);r.push(f.options.style[c])}l.push(r)}e=l}}else navigator&&navigator.clipboard?navigator.clipboard.read().then(function(e){e[0].getType("text/html").then(function(e){return new Response(e).text().then(function(e){h(e)})})}):e=jspreadsheet.styleCopied;if(e){for(var i=parseInt(f.selectedCell[0]),p=parseInt(f.selectedCell[1]),d={},y=0;y<e.length;y++)for(var r=e[y],u=0;u<r.length;u++){l=r[u];d[c=jspreadsheet.getColumnNameFromId([i+u,p+y])]=l}f.setStyle(d,null,null,!0)}},c.pasteOnlyValue=function(){c.paste(!0)},c.options.allow_pastestyle&&(s=jspreadsheet.pasteControls,jspreadsheet.pasteControls=function(e){s(e),jspreadsheet.current&&jspreadsheet.current.selectedCell&&(jspreadsheet.current.edition||(e&&e.clipboardData&&e.clipboardData.types&&e.clipboardData.getData?(e.clipboardData.types instanceof DOMStringList&&e.clipboardData.types.contains("text/html")||e.clipboardData.types.indexOf&&-1!==e.clipboardData.types.indexOf("text/html"))&&h(e.clipboardData.getData("text/html")):window.clipboardData&&window.clipboardData.types&&window.clipboardData.getData&&(window.clipboardData.types instanceof DOMStringList&&window.clipboardData.types.contains("text/html")||window.clipboardData.types.indexOf&&-1!==window.clipboardData.types.indexOf("text/html"))&&h(window.clipboardData.getData("text/html"))))}),c}});